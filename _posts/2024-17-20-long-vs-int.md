---
title: Java 순차 증가 PK 데이터 타입 Long vs Int
date: 2024-07-20 11:00:00 +/-TTTT
categories: [JAVA]
tags: [Java] # TAG names should always be lowercase
description: 할일 관리 홈 화면 추가하기
---

[할일 관리 프로젝트의 Todo 도메인](/_site/posts/springboot-todo2/index.html#도메인)에서는 `id`의 데이터 타입으로 `long`을 사용하였습니다.
```java
public class Todo {
    private Long id;
    private String content;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    // ...
}
```

`int` 와 `long` 둘 다 정수를 저장하는 타입이며, `long`이 더 큰 숫자를 저장할 수 있습니다.

- int
```
32bit(=4byte)
범위 : -2,147,483,648 ~ 2,147,483,647
```

- long
```
64bit(=8byte)
범위 : -9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807
```

## 순차 증가 ID의 타입으로 int와 long 중 무엇을 써야할까?

SI 회사에 있을 때 인트라넷에서만 사용하는 프로그램을 만들어 납품했었는데, 이때는 사용자가 `long`까지 갈 일이 없으니 `int`로 해도 무방하다고 생각했습니다. _사실 int 범위에 도달할 일도 없었지만, 그냥 int로 타입을 지정해서 썼던 것 같습니다._

만약 사용자 규모가 매우 크다면 당연히 `long`을 써야 할 텐데, 스타트업의 경우는 어떨까요?

[우아한 기술 블로그 - 개발자 머피의 법칙: Primary Key는 int 가 아니라 long 으로](https://techblog.woowahan.com/2645/)에서는 다음과 같은 말이 있습니다.
> 너무도 명명백백하게 어떤 상황에서도 Integer 범위를 넘길 수 없는 경우가 아니라면 순차 증가 기본키는 Long으로 매핑하는게 이득인 것 같습니다.  

블로그 내용을 요약하자면, Integer로 설정된 Primary Key는 서비스가 성공적으로 성장하면 범위를 초과하여 장애를 유발할 수 있으며, 나중에 Integer를 Long으로 변경하는 것은 매우 비용이 많이 들 뿐 아니라 연계 시스템의 하나라도 Integer로 남아있으면 전면 장애로 이어질 수 있으니 **처음부터 Long으로 설정하는 것이 좋다**는 내용입니다.

게임 회사에서 서버 개발자로 일할 때, 유저의 아이템 컬럼 타입이 `smallint`로 설정되어 있었는데, 게임 서비스를 10년 정도 오래 하다 보니 모인 아이템 수량이 곧 한계에 도달하는 유저들이 생겨나기 시작했습니다. 최대 획득 수량에 제한이 없었기에 메시지함에서 획득을 하면 계속 쌓이는 구조였지요. 
DAU가 200만 정도일 때라 무작정 ALTER 문을 날리기에는 리스크가 크기에 점검을 걸어야 할지 DBA 분과 상의하고, 문제되고 있는 다른 컬럼은 없는지 전수조사를 했던 기억이 납니다. 
> DAU란 24시간 동안 앱을 사용하는 순 유저 수를 의미합니다.
{: .prompt-tip }

처음부터 범위를 넓게 설정했다면 이렇게 나중에 수정할 일이 발생하지 않았겠죠?🥲

## 그냥 ALTER TABLE로 타입을 수정하면 안되나?
특정 테이블에 대한 ALTER 명령 실행 시, 작업이 완료될 때까지 해당 테이블 전체에 락이 걸립니다. 이로 인해 해당 테이블에 대한 모든 읽기 및 쓰기 작업이 대기 상태로 전환됩니다. 테이블의 크기가 큰 경우, 락이 걸리는 시간이 길어질 수 있습니다.

만약 락이 걸린 사이에 유저가 아이템을 획득하려고 시도하면, 데이터베이스가 테이블에 걸린 락이 해제될 때까지 해당 요청을 처리하지 못하게 됩니다. 그동안 유저는 응답을 받을 수 없으며, 서버 또한 데이터베이스의 응답을 기다리게 되어 대기 상태가 됩니다.
이러한 대기 상태가 길어지면 서버 자원이 소모되고, 동시에 많은 유저가 대기 상태에 놓일 경우 서버 부하가 급격히 증가하게 됩니다. 이로 인해 유저가 게임 플레이를 제대로 할 수 없게 되어 고객센터에 문의가 빗발치게 되겠지요.😢

DDL 명령어를 포함한 SQL 파일을 작성하여 DBA께 전달했고, 실제 서비스 환경에서 실행된 적이 있었습니다. 원래라면 사전에 공유를 해야 했지만 그러지 못한 것이 문제였습니다. 이로 인해 서버 응답 속도가 눈에 띄게 감소하고, 실제 게임 플레이도 많이 느려졌습니다. 이번에는 점검 없이 문제를 해결할 수 있었지만, 앞으로는 반드시 미리 공유를 해야 한다고 DBA께 당부 받은 적이 있습니다.
그때 제가 할 수 있는 거라곤 서버 에러 로그 카운트가 줄어드는지 확인하면서 부디 잘 해결되길 기도하는 수밖에 없었는데, 그때 생각하면 아직도 등골이 서늘하네요.💦

> DBA란 데이터베이스 관리를 전문적으로 하는 직업을 뜻합니다.
{: .prompt-tip }
---

이처럼 처음부터 큰 범위로 설정해 준다면 이후에 신경 쓸 일이 없으니 `int`와 `long` 중 고민되신다면 `long`으로 하는게 좋을 것 같습니다.
